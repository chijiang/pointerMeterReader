# LCD 数字表读取功能说明

## 📱 新增功能

在现有的工业仪表读数应用中，我们新增了 **LCD 液晶数字表读取** 功能。该功能使用训练好的 YOLO v10 模型来检测和识别液晶显示屏上的数字。

## 🎯 功能特性

### 数字检测
- **支持的字符**: 数字 0-9 和小数点 (point)
- **智能识别**: 自动识别液晶屏上的各个数字
- **高精度**: 基于专门训练的 YOLO v10 模型

### 重复检测过滤
- **距离过滤**: 过滤距离过近的相同数字（防止重复识别）
- **重叠过滤**: 基于 IoU (Intersection over Union) 过滤重叠检测
- **置信度排序**: 保留置信度最高的检测结果

### 读数重建
- **空间排序**: 按从左到右的顺序排列数字（高位到低位）
- **格式验证**: 自动清理和验证读数格式
- **小数点处理**: 正确处理小数点位置

## 🚀 使用方法

### 1. 启动应用
```bash
python app.py
```

### 2. 访问界面
打开浏览器访问 `http://localhost:7860`

### 3. 选择功能
- 点击 **"📱 LCD Display Reading"** 标签页
- 这将切换到液晶数字表读取功能

### 4. 上传图像
- 上传包含液晶数字显示的图像
- 支持 JPG、PNG、BMP 格式

### 5. 调整参数

#### 检测设置
- **Detection Confidence (0.1-0.9)**: 检测置信度阈值
  - 较高值: 更严格的检测，减少误检
  - 较低值: 更宽松的检测，可能增加误检但减少漏检

#### 重复过滤设置
- **Overlap Threshold (0.1-1.0)**: 重叠阈值 (IoU)
  - 较高值: 更严格的重叠判断
  - 较低值: 更宽松的重叠判断

- **Distance Threshold (5-100 pixels)**: 距离阈值
  - 较大值: 较远的相同数字也会被认为是重复
  - 较小值: 只有非常接近的数字才被认为是重复

### 6. 查看结果
- **Raw Detections**: 显示所有原始检测结果
- **Filtered Detections**: 显示过滤后的最终检测结果
- **Detection Summary**: 详细的检测统计和最终读数

## ⚙️ 模型配置

### 模型位置
模型文件应放置在: `models/detection/digits_model.pt`

### 训练自己的模型
如果需要训练专门的数字检测模型，可以使用项目中提供的训练脚本:

```bash
# 快速训练
python scripts/start_digits_training.py

# 或手动训练
python scripts/train_digits.py --config config/digits_config.yaml --visualize
```

## 📊 参数推荐

### 清晰显示
- Detection Confidence: 0.5-0.7
- Overlap Threshold: 0.7
- Distance Threshold: 20-30

### 模糊/低质量显示
- Detection Confidence: 0.2-0.4
- Overlap Threshold: 0.5-0.6
- Distance Threshold: 40-50

### 密集显示（数字间距小）
- Detection Confidence: 0.4-0.6
- Overlap Threshold: 0.8
- Distance Threshold: 15-25

## 🔧 技术细节

### 架构
```
LCD图像 → YOLO检测 → 重复过滤 → 空间排序 → 读数重建
```

### 类别定义
- 类别 0-9: 数字 0 到 9
- 类别 10: 小数点 (point)

### 过滤算法
1. **置信度排序**: 按检测置信度从高到低排序
2. **距离计算**: 计算检测框中心点之间的欧氏距离
3. **IoU计算**: 计算边界框的交并比
4. **重复判断**: 同类别且(距离<阈值 OR IoU>阈值)则认为重复
5. **保留最优**: 保留置信度最高的检测结果

### 读数重建
1. **空间排序**: 按检测框中心的 x 坐标从左到右排序
2. **字符拼接**: 将数字和小数点按顺序拼接
3. **格式清理**: 
   - 移除多余的小数点
   - 移除首尾的小数点
   - 确保只有一个小数点
   - 空结果返回 "0"

## 🐛 故障排除

### 常见问题

1. **检测不到数字**
   - 降低检测置信度阈值
   - 检查图像质量和清晰度
   - 确保数字足够大且清晰

2. **重复检测**
   - 降低重叠阈值
   - 增加距离阈值
   - 检查图像中是否有重影

3. **读数顺序错误**
   - 确保图像是水平放置的
   - 检查数字是否在同一水平线上

4. **小数点识别错误**
   - 调整小数点的置信度阈值
   - 检查小数点是否清晰可见

### 性能优化
- 使用 GPU 加速 (CUDA/MPS)
- 适当调整图像尺寸
- 批量处理多个图像时可调整批大小

## 📞 技术支持

如需技术支持或有改进建议，请：
1. 检查模型文件是否正确放置
2. 确认依赖库版本兼容
3. 查看控制台错误信息
4. 尝试不同的参数设置

---

**作者**: chijiang  
**更新时间**: 2025-01-15  
**版本**: 1.0 