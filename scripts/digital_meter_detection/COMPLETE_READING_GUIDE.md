# æ¶²æ™¶æ•°å­—è¡¨è¯»æ•°æå–å®Œæ•´æŒ‡å—
Digital Meter Reading Extraction Complete Guide

## æ¦‚è¿°

æœ¬æŒ‡å—ä»‹ç»å¦‚ä½•ä½¿ç”¨é›†æˆçš„æ¶²æ™¶æ•°å­—è¡¨è¯»æ•°æå–ç³»ç»Ÿï¼Œè¯¥ç³»ç»Ÿæ•´åˆäº†æ£€æµ‹ã€å¢å¼ºå’ŒOCRæŠ€æœ¯ï¼Œæä¾›ç«¯åˆ°ç«¯çš„è‡ªåŠ¨åŒ–æ•°å­—è¯»å–è§£å†³æ–¹æ¡ˆã€‚

## åŠŸèƒ½ç‰¹æ€§

### ğŸ” æ™ºèƒ½æ£€æµ‹
- **YOLOç›®æ ‡æ£€æµ‹**: è‡ªåŠ¨å®šä½æ¶²æ™¶æ˜¾ç¤ºå±åŒºåŸŸ
- **é«˜ç²¾åº¦è¾¹ç•Œæ¡†**: å‡†ç¡®æ¡†é€‰æ•°å­—æ˜¾ç¤ºåŒºåŸŸ
- **å¤šç›®æ ‡æ”¯æŒ**: åŒæ—¶æ£€æµ‹å¤šä¸ªæ˜¾ç¤ºå±

### âœ‚ï¸ æ™ºèƒ½è£å‰ª
- **è‡ªåŠ¨åŒºåŸŸæå–**: åŸºäºæ£€æµ‹ç»“æœè‡ªåŠ¨è£å‰ª
- **è¾¹ç•Œä¼˜åŒ–**: è‡ªåŠ¨æ·»åŠ é€‚å½“çš„è¾¹è·
- **æ‰¹é‡å¤„ç†**: æ”¯æŒå¤šä¸ªæ£€æµ‹åŒºåŸŸåŒæ—¶å¤„ç†

### ğŸ¨ å›¾åƒå¢å¼º
- **åå…‰å»é™¤**: æ™ºèƒ½æ£€æµ‹å’Œä¿®å¤é«˜äº®åå…‰åŒºåŸŸ
- **å¯¹æ¯”åº¦å¢å¼º**: CLAHEç®—æ³•æå‡å±€éƒ¨å¯¹æ¯”åº¦
- **å›¾åƒé”åŒ–**: æ‹‰æ™®æ‹‰æ–¯ç®—å­å¢å¼ºè¾¹ç¼˜æ¸…æ™°åº¦
- **æ•°å­—æå–**: å¤šé˜ˆå€¼æ–¹æ³•åˆ†ç¦»æ•°å­—åŒºåŸŸ

### ğŸ”¤ OCRè¯†åˆ«
- **å¤šå¼•æ“æ”¯æŒ**: EasyOCRã€PaddleOCRã€Tesseract
- **æ™ºèƒ½éªŒè¯**: è‡ªåŠ¨æ ¡éªŒæ•°å­—æ ¼å¼å’Œåˆç†æ€§
- **ç½®ä¿¡åº¦è¯„ä¼°**: ä¸ºæ¯ä¸ªè¯†åˆ«ç»“æœæä¾›å¯ä¿¡åº¦åˆ†æ•°

### ğŸ“Š ç»“æœè¾“å‡º
- **è¯¦ç»†æ—¥å¿—**: å®Œæ•´çš„å¤„ç†è¿‡ç¨‹è®°å½•
- **å¯è§†åŒ–ç»“æœ**: æ£€æµ‹æ¡†ã€å¤„ç†æ­¥éª¤ã€æœ€ç»ˆç»“æœ
- **ç»“æ„åŒ–æ•°æ®**: JSONæ ¼å¼çš„è¯¦ç»†ç»“æœ
- **æŠ¥å‘Šç”Ÿæˆ**: Markdownæ ¼å¼çš„å¤„ç†æŠ¥å‘Š

## å®‰è£…è¦æ±‚

### åŸºç¡€ä¾èµ–
```bash
pip install opencv-python numpy torch ultralytics
pip install matplotlib tqdm pathlib
```

### OCRå¼•æ“
```bash
# EasyOCR (æ¨è)
pip install easyocr

# PaddleOCR (å¯é€‰)
pip install paddleocr

# Tesseract (å¯é€‰)
pip install pytesseract
# éœ€è¦ç³»ç»Ÿå®‰è£…: brew install tesseract (macOS)
```

### é¡¹ç›®æ¨¡å—
ç¡®ä¿ä»¥ä¸‹æ¨¡å—å¯ç”¨ï¼š
- `scripts.digital_meter_detection.enhancement.digital_enhancement`
- `scripts.digital_meter_detection.ocr.digital_ocr_extractor`

## ä½¿ç”¨æ–¹æ³•

### 1. å‡†å¤‡æ¨¡å‹æ–‡ä»¶

ç¡®ä¿è®­ç»ƒå¥½çš„YOLOæ£€æµ‹æ¨¡å‹å­˜åœ¨ï¼š
```
models/detection/digital_detection_model.pt
```

å¦‚æœæ²¡æœ‰æ¨¡å‹æ–‡ä»¶ï¼Œéœ€è¦å…ˆè®­ç»ƒæ£€æµ‹æ¨¡å‹ã€‚

### 2. å‘½ä»¤è¡Œä½¿ç”¨

#### å•å¼ å›¾åƒå¤„ç†
```bash
python digital_meter_reading.py --input /path/to/image.jpg
```

#### æ‰¹é‡å¤„ç†
```bash
python digital_meter_reading.py --input /path/to/images/
```

#### é«˜çº§é€‰é¡¹
```bash
python digital_meter_reading.py \
    --input /path/to/images/ \
    --model custom_model.pt \
    --output custom_output/ \
    --ocr-engine easyocr \
    --device cuda \
    --confidence 0.6 \
    --no-enhancement \
    --debug
```

### 3. é€šè¿‡å¯åŠ¨è„šæœ¬

ä»é¡¹ç›®æ ¹ç›®å½•è¿è¡Œï¼š
```bash
cd scripts/digital_meter_detection/
python run.py
```

é€‰æ‹©é€‰é¡¹ "8. ğŸ”¢ å®Œæ•´è¯»æ•°æå–ï¼ˆæ£€æµ‹+å¢å¼º+OCRï¼‰"

### 4. å‚æ•°è¯´æ˜

| å‚æ•° | æè¿° | é»˜è®¤å€¼ |
|------|------|--------|
| `--input` | è¾“å…¥å›¾åƒæ–‡ä»¶æˆ–ç›®å½• | å¿…éœ€ |
| `--model` | YOLOæ£€æµ‹æ¨¡å‹è·¯å¾„ | `models/detection/digital_detection_model.pt` |
| `--output` | è¾“å‡ºç›®å½• | è‡ªåŠ¨ç”Ÿæˆæ—¶é—´æˆ³ç›®å½• |
| `--ocr-engine` | OCRå¼•æ“é€‰æ‹© | `easyocr` |
| `--device` | è®¾å¤‡é€‰æ‹© | `auto` |
| `--confidence` | æ£€æµ‹ç½®ä¿¡åº¦é˜ˆå€¼ | `0.5` |
| `--no-enhancement` | ç¦ç”¨å›¾åƒå¢å¼º | é»˜è®¤å¯ç”¨ |
| `--debug` | å¯ç”¨è°ƒè¯•æ¨¡å¼ | é»˜è®¤å…³é—­ |

## è¾“å‡ºç»“æ„

å¤„ç†å®Œæˆåï¼Œç»“æœå°†ä¿å­˜åœ¨ä»¥ä¸‹ç»“æ„ä¸­ï¼š

```
outputs/digital_meter_reading/reading_YYYYMMDD_HHMMSS/
â”œâ”€â”€ 1_detection/              # æ£€æµ‹å¯è§†åŒ–ç»“æœ
â”‚   â””â”€â”€ image_detection.jpg   # æ£€æµ‹æ¡†æ ‡æ³¨å›¾åƒ
â”œâ”€â”€ 2_cropped/                # è£å‰ªçš„æ˜¾ç¤ºå±åŒºåŸŸ
â”‚   â””â”€â”€ image_crop_00.jpg     # è£å‰ªçš„æ¶²æ™¶å±å›¾åƒ
â”œâ”€â”€ 3_enhanced/               # å¢å¼ºåçš„å›¾åƒ
â”‚   â””â”€â”€ image_crop_00_enhanced.jpg  # å¢å¼ºå¤„ç†åå›¾åƒ
â”œâ”€â”€ 4_ocr_results/            # OCRè¯¦ç»†ç»“æœ
â”‚   â””â”€â”€ [OCRå¼•æ“ç»“æœæ–‡ä»¶]
â”œâ”€â”€ 5_visualization/          # æœ€ç»ˆå¯è§†åŒ–ç»“æœ
â”‚   â””â”€â”€ image_final_result.jpg  # å¸¦è¯»æ•°æ ‡æ³¨çš„æœ€ç»ˆç»“æœ
â”œâ”€â”€ batch_results.json        # è¯¦ç»†ç»“æœæ•°æ®
â”œâ”€â”€ batch_report.md           # å¤„ç†æŠ¥å‘Š
â””â”€â”€ digital_meter_reading.log # å¤„ç†æ—¥å¿—
```

## ç»“æœæ ¼å¼

### JSONç»“æœç¤ºä¾‹
```json
{
  "success": true,
  "total_images": 1,
  "successful_images": 1,
  "total_detections": 2,
  "successful_readings": 1,
  "processing_time": 15.23,
  "results": [
    {
      "image_name": "meter_image.jpg",
      "detections_count": 2,
      "readings": [
        {
          "bbox": [150, 100, 450, 200],
          "confidence": 0.85,
          "extracted_value": 123.45,
          "ocr_success": true
        }
      ]
    }
  ]
}
```

## å¤„ç†æµç¨‹

### 1. å›¾åƒåŠ è½½ä¸æ£€æµ‹
```
è¾“å…¥å›¾åƒ â†’ YOLOæ£€æµ‹ â†’ è·å–è¾¹ç•Œæ¡† â†’ ç”Ÿæˆæ£€æµ‹å¯è§†åŒ–
```

### 2. åŒºåŸŸè£å‰ª
```
æ£€æµ‹ç»“æœ â†’ æ·»åŠ è¾¹è· â†’ è£å‰ªåŒºåŸŸ â†’ ä¿å­˜è£å‰ªå›¾åƒ
```

### 3. å›¾åƒå¢å¼ºï¼ˆå¯é€‰ï¼‰
```
è£å‰ªå›¾åƒ â†’ åå…‰å»é™¤ â†’ å¯¹æ¯”åº¦å¢å¼º â†’ å›¾åƒé”åŒ– â†’ æ•°å­—æå–
```

### 4. OCRè¯†åˆ«
```
å¢å¼ºå›¾åƒ â†’ OCRå¼•æ“å¤„ç† â†’ ç»“æœéªŒè¯ â†’ ç½®ä¿¡åº¦è¯„ä¼°
```

### 5. ç»“æœæ•´åˆ
```
æ‰€æœ‰ç»“æœ â†’ æ•°æ®æ•´åˆ â†’ å¯è§†åŒ–ç”Ÿæˆ â†’ æŠ¥å‘Šè¾“å‡º
```

## æ€§èƒ½ä¼˜åŒ–

### è®¾å¤‡é€‰æ‹©
- **GPUåŠ é€Ÿ**: ä½¿ç”¨ `--device cuda` å¯ç”¨CUDAåŠ é€Ÿ
- **Apple Silicon**: ä½¿ç”¨ `--device mps` å¯ç”¨MetalåŠ é€Ÿ
- **CPUæ¨¡å¼**: ä½¿ç”¨ `--device cpu` ä½¿ç”¨CPUå¤„ç†

### æ‰¹é‡å¤„ç†å»ºè®®
- å°†ç›¸å…³å›¾åƒæ”¾åœ¨åŒä¸€ç›®å½•ä¸‹
- ä½¿ç”¨åˆé€‚çš„ç½®ä¿¡åº¦é˜ˆå€¼è¿‡æ»¤æ£€æµ‹ç»“æœ
- å¯ç”¨å›¾åƒå¢å¼ºä»¥æé«˜OCRå‡†ç¡®ç‡

### å†…å­˜ä¼˜åŒ–
- å¤§æ‰¹é‡å¤„ç†æ—¶è€ƒè™‘åˆ†æ‰¹è¿›è¡Œ
- è°ƒè¯•æ¨¡å¼ä¼šå ç”¨æ›´å¤šå†…å­˜ï¼Œç”Ÿäº§ç¯å¢ƒå»ºè®®å…³é—­

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

#### 1. æ¨¡å‹æ–‡ä»¶ä¸å­˜åœ¨
```
âŒ æ¨¡å‹æ–‡ä»¶ä¸å­˜åœ¨: models/detection/digital_detection_model.pt
```
**è§£å†³æ–¹æ¡ˆ**: ç¡®ä¿å·²è®­ç»ƒå¥½æ£€æµ‹æ¨¡å‹ï¼Œæˆ–ä½¿ç”¨ `--model` å‚æ•°æŒ‡å®šæ­£ç¡®è·¯å¾„

#### 2. æœªæ£€æµ‹åˆ°æ˜¾ç¤ºå±
```
âš ï¸ æœªæ£€æµ‹åˆ°æ¶²æ™¶æ˜¾ç¤ºå±
```
**è§£å†³æ–¹æ¡ˆ**: 
- é™ä½ç½®ä¿¡åº¦é˜ˆå€¼ `--confidence 0.3`
- æ£€æŸ¥å›¾åƒè´¨é‡å’Œæ˜¾ç¤ºå±æ¸…æ™°åº¦
- ç¡®è®¤æ¨¡å‹è®­ç»ƒè´¨é‡

#### 3. OCRè¯†åˆ«å¤±è´¥
```
âš ï¸ OCRå¤±è´¥: image.jpg
```
**è§£å†³æ–¹æ¡ˆ**:
- å¯ç”¨å›¾åƒå¢å¼º (é»˜è®¤å¯ç”¨)
- å°è¯•ä¸åŒçš„OCRå¼•æ“
- æ£€æŸ¥è£å‰ªåŒºåŸŸæ˜¯å¦åŒ…å«å®Œæ•´æ•°å­—

#### 4. å†…å­˜ä¸è¶³
```
RuntimeError: CUDA out of memory
```
**è§£å†³æ–¹æ¡ˆ**:
- ä½¿ç”¨CPUæ¨¡å¼ `--device cpu`
- å‡å°æ‰¹é‡å¤„ç†è§„æ¨¡
- å…³é—­è°ƒè¯•æ¨¡å¼

### è°ƒè¯•æŠ€å·§

#### å¯ç”¨è°ƒè¯•æ¨¡å¼
```bash
python digital_meter_reading.py --input image.jpg --debug
```

#### æŸ¥çœ‹å¤„ç†æ—¥å¿—
```bash
tail -f outputs/digital_meter_reading/reading_*/digital_meter_reading.log
```

#### æ£€æŸ¥ä¸­é—´ç»“æœ
æ¯ä¸ªå¤„ç†æ­¥éª¤çš„ç»“æœéƒ½ä¼šä¿å­˜åœ¨å¯¹åº”çš„å­ç›®å½•ä¸­ï¼Œå¯ä»¥é€æ­¥æ£€æŸ¥å¤„ç†æ•ˆæœã€‚

## åŠŸèƒ½æµ‹è¯•

è¿è¡ŒåŠŸèƒ½æµ‹è¯•ä»¥éªŒè¯ç³»ç»Ÿå®Œæ•´æ€§ï¼š

```bash
python test_digital_meter_reading.py
```

æˆ–é€šè¿‡å¯åŠ¨è„šæœ¬é€‰æ‹© "9. ğŸ§ª åŠŸèƒ½æµ‹è¯•"

## é›†æˆç¤ºä¾‹

### Pythonè„šæœ¬é›†æˆ
```python
from digital_meter_reading import DigitalMeterReader

# åˆ›å»ºè¯»æ•°æå–å™¨
reader = DigitalMeterReader(
    model_path="models/detection/digital_detection_model.pt",
    ocr_engine="easyocr",
    enhancement_enabled=True
)

# å¤„ç†å•å¼ å›¾åƒ
result = reader.process_single_image("test_image.jpg")

if result['success']:
    print(f"æ£€æµ‹åˆ° {result['detections_count']} ä¸ªæ˜¾ç¤ºå±")
    print(f"æˆåŠŸè¯»å– {result['successful_readings']} ä¸ªæ•°å€¼")
    
    for reading in result['readings']:
        if reading['ocr_success']:
            print(f"è¯»æ•°: {reading['extracted_value']}")
```

### æ‰¹é‡å¤„ç†é›†æˆ
```python
# æ‰¹é‡å¤„ç†
batch_result = reader.process_batch("images_directory/")

if batch_result['success']:
    print(f"å¤„ç†å›¾åƒ: {batch_result['successful_images']}/{batch_result['total_images']}")
    print(f"æ€»è¯»æ•°: {batch_result['successful_readings']}")
```

## æœ€ä½³å®è·µ

### å›¾åƒè´¨é‡è¦æ±‚
- **åˆ†è¾¨ç‡**: å»ºè®®è‡³å°‘800x600åƒç´ 
- **æ¸…æ™°åº¦**: é¿å…æ¨¡ç³Šå’Œè¿åŠ¨æ¨¡ç³Š
- **å…‰ç…§**: å‡åŒ€å…‰ç…§ï¼Œé¿å…å¼ºçƒˆåå…‰
- **è§’åº¦**: æ­£é¢æ‹æ‘„ï¼Œé¿å…ä¸¥é‡å€¾æ–œ

### æ¨¡å‹è®­ç»ƒå»ºè®®
- ä½¿ç”¨å¤šæ ·åŒ–çš„è®­ç»ƒæ•°æ®
- åŒ…å«ä¸åŒå…‰ç…§æ¡ä»¶çš„æ ·æœ¬
- æ ‡æ³¨å‡†ç¡®çš„è¾¹ç•Œæ¡†
- å®šæœŸéªŒè¯æ¨¡å‹æ€§èƒ½

### ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²
- ä½¿ç”¨GPUåŠ é€Ÿæé«˜å¤„ç†é€Ÿåº¦
- å®šæœŸå¤‡ä»½å¤„ç†ç»“æœ
- ç›‘æ§ç³»ç»Ÿèµ„æºä½¿ç”¨æƒ…å†µ
- å»ºç«‹ç»“æœè´¨é‡æ£€æŸ¥æœºåˆ¶

---

*æ›´æ–°æ—¶é—´: 2025-06-09*  
*ç‰ˆæœ¬: v1.0*  
*ä½œè€…: chijiang* 